---
id: comparar-con-deteccion-vitalidad
title: Comparar con Detección de Vitalidad (Secuencial)
description: Comparación 1:1 más detección de vitalidad con umbrales
slug: /comparar-con-deteccion-vitalidad
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

### Endpoint

```
POST https://api.verifik.co/v2/face-recognition/compare-with-liveness
```

Realiza la comparación primero y, si la comparación cumple con `compare_min_score` (o si no se proporciona), procede a la detección de vitalidad en la prueba con `liveness_min_score`.

### Headers

| Name | Value |
| --- | --- |
| Content-Type | `application/json` |
| Authorization | `Bearer <token>` |

### Parámetros

| Name | Type | Required | Description |
| --- | --- | --- | --- |
| `probe` | string | Sí | Cadena de imagen base64 para la captura en vivo. |
| `gallery` | string[] | Sí | Array de cadenas de imagen base64 para comparar. Se admiten URLs y serán descargadas y convertidas internamente. |
| `search_mode` | string | Sí | Uno de `FAST` o `ACCURATE`. |
| `liveness_min_score` | number | No | Umbral de vitalidad; por defecto 0.6 si no se proporciona. |
| `compare_min_score` | number | No | Umbral de comparación opcional (0.67–0.95). |
| `cropFace` | boolean | No | Si es `true`, intenta recortar caras en la galería antes de la comparación. |

### Solicitud

<Tabs>
  <TabItem value="node" label="Node.js">

```javascript
const fetch = require("node-fetch");

async function run() {
  const res = await fetch("https://api.verifik.co/v2/face-recognition/compare-with-liveness", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${process.env.VERIFIK_TOKEN}`,
    },
    body: JSON.stringify({
      probe: "<base64>",
      gallery: ["<base64>"],
      search_mode: "FAST",
      liveness_min_score: 0.6,
      compare_min_score: 0.8,
      cropFace: true
    }),
  });
  console.log(await res.json());
}

run();
```

  </TabItem>
  <TabItem value="php" label="PHP">

```php
<?php
$ch = curl_init("https://api.verifik.co/v2/face-recognition/compare-with-liveness");
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    "Content-Type: application/json",
    "Authorization: Bearer " . getenv("VERIFIK_TOKEN")
]);
$body = json_encode([
    "probe" => "<base64>",
    "gallery" => ["<base64>"],
    "search_mode" => "ACCURATE",
    "liveness_min_score" => 0.6,
    "compare_min_score" => 0.8,
    "cropFace" => true
]);
curl_setopt($ch, CURLOPT_POSTFIELDS, $body);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
$response = curl_exec($ch);
curl_close($ch);
echo $response;
```

  </TabItem>
  <TabItem value="python" label="Python">

```python
import os, requests

url = "https://api.verifik.co/v2/face-recognition/compare-with-liveness"
headers = {
    "Content-Type": "application/json",
    "Authorization": f"Bearer {os.getenv('VERIFIK_TOKEN')}"
}
payload = {
    "probe": "<base64>",
    "gallery": ["<base64>"],
    "search_mode": "FAST",
    "liveness_min_score": 0.6,
    "compare_min_score": 0.8,
    "cropFace": True
}
r = requests.post(url, json=payload, headers=headers)
print(r.json())
```

  </TabItem>
  <TabItem value="go" label="Go">

```go
package main

import (
    "bytes"
    "encoding/json"
    "fmt"
    "net/http"
    "os"
)

func main() {
    payload := map[string]interface{}{
        "probe": "<base64>",
        "gallery": []string{"<base64>"},
        "search_mode": "FAST",
        "liveness_min_score": 0.6,
        "compare_min_score": 0.8,
        "cropFace": true,
    }
    b, _ := json.Marshal(payload)
    req, _ := http.NewRequest("POST", "https://api.verifik.co/v2/face-recognition/compare-with-liveness", bytes.NewBuffer(b))
    req.Header.Set("Content-Type", "application/json")
    req.Header.Set("Authorization", "Bearer "+os.Getenv("VERIFIK_TOKEN"))
    resp, _ := http.DefaultClient.Do(req)
    defer resp.Body.Close()
    var out map[string]interface{}
    json.NewDecoder(resp.Body).Decode(&out)
    fmt.Println(out)
}
```

  </TabItem>
</Tabs>

### Respuesta

<Tabs>
  <TabItem value="200" label="200">

```json
{
  "id": "CWL01",
  "data": {
    "comparison": {
      "score": 0.88
    },
    "liveness": {
      "liveness_score": 0.91,
      "min_score": 0.6,
      "passed": true
    }
  },
  "signature": {
    "message": "Certified by Verifik.co",
    "dateTime": "January 16, 2024 3:44 PM"
  }
}
```

  </TabItem>
  <TabItem value="401-403" label="401/403">

```json
{
  "message": "Authentication required",
  "code": "UNAUTHORIZED"
}
```

o

```json
{
  "message": "token_expired",
  "code": "FORBIDDEN"
}
```

  </TabItem>
  <TabItem value="409" label="409">

```json
{
  "message": "\"search_mode\" is required",
  "code": "MissingParameter"
}
```

  </TabItem>
  <TabItem value="412" label="412">

```json
{
  "message": "only_images_in_base64",
  "code": "ERROR"
}
```

  </TabItem>
  <TabItem value="500" label="500">

```json
{
  "message": "internal_error",
  "code": "ERROR"
}
```

  </TabItem>
</Tabs>

### Notas

- La comparación se ejecuta primero. Solo si `compare_min_score` no se proporciona o se cumple, se ejecuta la detección de vitalidad en `probe`.
- `liveness_min_score` por defecto es 0.6 si no se proporciona.
- La galería admite URLs `https` y serán descargadas y convertidas a base64 internamente; `cropFace` opcionalmente recorta caras antes de la comparación.

